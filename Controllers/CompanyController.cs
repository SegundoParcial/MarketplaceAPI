using Microsoft.AspNetCore.Authorization; using Microsoft.AspNetCore.Mvc; using Microsoft.EntityFrameworkCore; using MarketplaceAPI.Data; using MarketplaceAPI.DTOs.Company; using MarketplaceAPI.Services; namespace MarketplaceAPI.Controllers; [ApiController][Route("api/v1/[controller]")] public class CompanyController:ControllerBase{ private readonly AppDbContext _db; public CompanyController(AppDbContext db){_db=db;} [HttpGet("me")][Authorize(Policy="Company")] public async Task<ActionResult<CompanyDto>> Me(){ var uid=User.GetUserId(); var c=await _db.Companies.FirstOrDefaultAsync(x=>x.OwnerUserId==uid); if(c is null) return NotFound(); return new CompanyDto(c.Id,c.Name);} [HttpPut("me")][Authorize(Policy="Company")] public async Task<IActionResult> Update(UpdateCompanyDto dto){ var uid=User.GetUserId(); var c=await _db.Companies.FirstOrDefaultAsync(x=>x.OwnerUserId==uid); if(c is null) return NotFound(); c.Name=dto.Name; await _db.SaveChangesAsync(); return NoContent(); } }