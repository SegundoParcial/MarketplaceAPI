using Microsoft.IdentityModel.Tokens; using System.IdentityModel.Tokens.Jwt; using System.Security.Claims; using System.Text; using MarketplaceAPI.Models; namespace MarketplaceAPI.Services; public class TokenService { private readonly SymmetricSecurityKey _key; public TokenService(IConfiguration cfg){var k=cfg["Jwt:Key"]??"devkey_change_me"; _key=new SymmetricSecurityKey(Encoding.UTF8.GetBytes(k));} public string CreateToken(User user, System.Guid? companyId){ var creds=new SigningCredentials(_key,SecurityAlgorithms.HmacSha256); var claims=new System.Collections.Generic.List<Claim>{ new(ClaimTypes.NameIdentifier,user.Id.ToString()), new(ClaimTypes.Email,user.Email), new(ClaimTypes.Role,user.Role)}; if(companyId.HasValue) claims.Add(new("companyId",companyId.Value.ToString())); var token=new JwtSecurityToken(claims:claims,expires:System.DateTime.UtcNow.AddHours(2),signingCredentials:creds); return new JwtSecurityTokenHandler().WriteToken(token);} }